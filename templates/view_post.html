{% extends "parent.html" %}
{% block header %}
{% endblock %}
{% block title %}Post {% endblock %}
{% block content %}
<script src=http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<div class="post-area">  
                      <div class="post">
                          <div class="post-top">
                          </div>
                              <div>
                                 <div style="position: relative;">
                                      <img class=" post-img pure-img" style="display: block;" src="{{url_for("view_post_image", post_id=current_post['post_id'])}}">
                                      {% if session['profile'] and session['profile']['user_id'] == current_post['user_id'] %}
                                            <form>
                                                <button formaction="{{ url_for('view_edit_post', post_id=current_post['post_id']) }}" formmethod="get" class="edit-post-button">
                                                    <i class="post-icon fa fa-pencil"></i>
                                                </button>
                                                <button formaction="{{ url_for('delete_post', post_id=current_post['post_id']) }}" formmethod="post" class="delete-post-button">
                                                    <i class="post-icon fa fa-trash"></i>
                                                </button>
                                            </form>
                                      {% endif %}
                                  </div>
                                  <table class="pure-table pure-table-horizontal post-table">
                                      <thead>
                                          <tr>
                                              <th>Exercise</th>
                                              <th>Sets</th>
                                              <th>Reps</th>
                                              <th>Time</th>
                                          </tr>
                                      </thead>
                                      <tbody>
                                      {% for exercise in current_exercises %}
                                          {% if exercise['post_id'] == current_post['post_id'] %}
                                              <tr>
                                                  <td>{{exercise['exercise_name']}}</td>
                                                  <td>
                                                      {% if exercise['num_sets'] == None %}
                                                          -
                                                      {% else %}
                                                          {{exercise['num_sets']}}
                                                      {% endif %}
                                                  </td>
                                                  <td>
                                                      {% if exercise['num_reps'] == None %}
                                                          -
                                                      {% else %}
                                                          {{exercise['num_reps']}}
                                                      {% endif %}
                                                  </td>
                                                  <td>
                                                      {% if exercise['num_time'] == None %}
                                                          -
                                                      {% else %}
                                                          {{exercise['num_time']}} {{exercise['time_units']}}
                                                      {% endif %}
                                                  </td>
                                              </tr>
                                          {% endif %}
                                      {% endfor %}
                                      </tbody>
                                  </table>
                                  <p class="post-caption">
                                      <b>
                                        {% for user in all_users %}
                                            {% if user['user_id'] == current_post['user_id'] %}
                                                <p>@{{ user['username'] }}
                                            {% endif %}
                                        {% endfor %}
                                      </b> {{ current_post['description'] }} <i>{{ current_post['tstamp'] }}</i> </p>
                                      
                              </div>
                          <div class="post-like-comment">
                              <div>
                                  <p>{{ num_likes[0] }}</p>
                                  <button id  = "like_button">
                                    <i class="pure-button fa fa-thumbs-up"></i>
                                  </button>
                                  <script>
                                        
                                    $('#like_button').click(function(){

                                        $.ajax({
                                        url: "{{url_for('like_post')}}",
                                        data: {
                                                post_id: {{ current_post['post_id'] }},
                                                user_id: "{{ session['profile']['user_id'] }}",
                                        },
                                        success: function(response){
                                            console.log("success");
                                        },
                                        type:'POST'
                                        })
                                    });
                                </script>
                              </div>
                              <div>
                              </div>
                          </div>
                          <div class = "comments">
                            <div id="all_comments">

                                {% for comment in all_comments %}
                                    {% for user in all_users %}
                                        {% if comment['post_id'] == current_post['post_id'] %}
                                            {% if user['user_id'] == comment['user_id'] %}
                                        
                                                <div>{{ comment['comment'] }} <b>@{{ user['username'] }}</b> <i>{{ comment['tstamp'] }}</i>  </div>
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                {% endfor %}
                            </div>
                                  <textarea name = "comment" id = "comment" rows = "5" cols = "50" placeholder="Comment"required></textarea>
                                  <button class = "pure-button" id  = "comment_button">Comment</button>
                                    <script>
                                        
        
                                        $('#comment_button').click(function(){
                                            var container = $("#all_comments");
                                            var input_comment = $('#comment').val();
                                            console.log(input_comment)
                                            $(container).append('<div>'+input_comment+'</div>'); //adding new input field

                                            $.ajax({
                                            url: "{{url_for('add_comment')}}",
                                            data: {
                                                    post_id: {{ current_post['post_id'] }},
                                                    user_id: "{{ current_post['user_id'] }}",
                                                    comment: input_comment
                                            },
                                            success: function(response){
                                                console.log("success");
                                            },
                                            type:'POST'
                                            })
                                        });
                                    </script>
                             </div>

                        </div>


                        </div>

                      
  </div>    
{% endblock %}